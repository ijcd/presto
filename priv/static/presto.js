!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Presto=e():t.Presto=e()}(window,function(){return function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:o})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=2)}([function(t,e,n){"use strict";var o;n.r(e),n.d(e,"Presto",function(){return r}),o=$.fn.attr,$.fn.attr=function(){if(0===arguments.length){if(0===this.length)return null;var t={};return $.each(this[0].attributes,function(){this.specified&&(t[this.name]=this.value)}),t}return o.apply(this,arguments)};class r{constructor(t,e){var n=this;this.channel=t,this.unpoly=e,this.stateChangeCallbacks={preUpdate:[],postUpdate:[]},this.allEventNames=Object.getOwnPropertyNames(document).concat(Object.getOwnPropertyNames(Object.getPrototypeOf(Object.getPrototypeOf(document)))).concat(Object.getOwnPropertyNames(Object.getPrototypeOf(window))).filter(function(t){return!t.indexOf("on")&&(null==document[t]||"function"==typeof document[t])}).filter(function(t,e,n){return n.indexOf(t)==e}),this.allEventNames.forEach(function(t){var e=".presto-"+(t=t.replace(/^on/,""));$("body").on(t,e,function(e){n.pushEvent(t,e)}),$("body"+e).on(t,function(e){n.pushEvent(t,e)})}),this.channel.on("presto",t=>{var{name:e}=t;switch(e){case"update_component":n.runPreUpdateHooks(t);var{component_selector:o,content:r}=t,a=document.activeElement;n.unpoly.extract(o,r),$(a).focus(),n.runPostUpdateHooks(t)}})}onPreUpdate(t){this.stateChangeCallbacks.preUpdate.push(t)}onPostUpdate(t){this.stateChangeCallbacks.postUpdate.push(t)}runPreUpdateHooks(t){this.stateChangeCallbacks.preUpdate.forEach(e=>e(t))}runPostUpdateHooks(t){this.stateChangeCallbacks.postUpdate.forEach(e=>e(t))}pushEvent(t,e){var n=$(e.target);this.channel.push("presto",{element:n.prop("tagName"),event:t,key_code:e.keyCode,attrs:n.attr(),id:n.prop("id"),component_id:n.parents(".presto-component").map((t,e)=>e.id).toArray().reverse()})}}},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";(function(e){t.exports=e.Presto=n(0)}).call(this,n(1))}])});